<html>
  <head>
    <meta charset="utf-8">
    <style>
        body{
            font-family: "Roboto", sans-serif;
        }
      .box{
        border: 1px solid #ccc;
        border-radius: 10px;
        padding: 0.25em;
        display: inline-block;
      }
      h2{
          margin-top: 0;
          padding-top: 0em;
          margin-bottom: 0;
      }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@2.0.0/dist/tf.min.js"></script>
  </head>
  <body>
    <h1>Kiel Air Quality Prediction</h1>
    <div class="box">
      <h2>Inputs</h2>
      Cars (n/h): <input id="cars" oninput="update()" type="range" value="650" min="0" max="2000" step="1"> <span id="cars-label"></span><br/>
      Diesel (€): <input id="diesel" oninput="update()" type="range" value="1.50" min="0.01" max="2" step="0.01"> <span id="diesel-label"></span><br/>
      Wind (m/s): <input id="wind" oninput="update()" type="range" value="3.6" min="0" max="20" step="0.1"> <span id="wind-label"></span><br/>
    </div>
    <br/><br/>
    <div class="box">
        <h2>Outputs</h2>
        <!--<span id="model-state">Loading model</span><br/>-->
        NO<sub>2</sub> (µg/m³): <span id="model-result"></span>
    </div>
    <script>
        let model = null;
        async function load_model(){
            model = await tf.loadLayersModel('./tfjs_model/model.json');
            //document.getElementById("model-state").innerText = "model loaded";
            console.log(model);
        }
        load_model();

        async function update(){
            let cars = parseFloat(document.getElementById('cars').value);
            let diesel = parseFloat(document.getElementById('diesel').value);
            let wind = parseFloat(document.getElementById('wind').value);

            document.getElementById('cars-label').innerText = cars;
            document.getElementById('diesel-label').innerText = diesel;
            document.getElementById('wind-label').innerText = wind;

            if(!model){
                setTimeout(update, 500);
                return;
            }

            let cars_scaled = cars / 1000.0;
            let diesel_scaled = diesel / 10.0;
            let wind_scaled = wind / 10.0;

            let inputs = tf.tensor([[cars_scaled, diesel_scaled, wind_scaled]]);

            let prediction = model.predict(inputs)
            let prediction_value = prediction.dataSync();

            //console.log(prediction_value);

            document.getElementById("model-result").innerText = prediction_value
            
        }



        update();
    </script>
  </body>
</html>